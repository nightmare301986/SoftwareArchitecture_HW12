# Архитектура ПО. Семинар 12. Принципы тестирования приложений

## Ручное тестирование

Ручное тестирование в Java может быть реализовано следующим образом:

1. Создать тестовые сценарии: определить шаги, которые должен выполнить пользователь, чтобы достичь определенного результата.

2. Создать классы, которые будут выполнять тесты. В этих классах можно использовать JUnit, TestNG или другие тестовые фреймворки для Java.

3. Запустить тесты и выполнить шаги в соответствии с тестовыми сценариями.

4. Убедиться, что результаты соответствуют ожидаемым.

5. Если результаты не соответствуют ожидаемым, зарегистрировать ошибку или недочет и отправить разработчикам для исправления.

6. Повторять тестирование до тех пор, пока все ошибки и недочеты не будут исправлены.

7. Документировать результаты тестирования для Отчетов.

8. Повторять тестирование при необходимости, особенно при внесении изменений в приложение. 


## Перехват и обработка исключений

Для работы с исключениями в Java существуют специальные блоки кода: `try`, `catch` и `finally`.
Код, в котором ожидается возникновение исключений, помещается в блок try. Это не значит, что исключение в этом месте обязательно произойдет. Это значит, что оно может там произойти, и нам надо его обработать. 

Тип ошибки, который ожидается получить, помещается в блок catch. Сюда же помещается весь код, который нужно выполнить, если исключение произойдет. 

Пример из файла Client.java:

```java
// метод подключения клиента к серверу
protected void connectToServer() {
	// если клиент не подключен к серверу, то…
	if (!isConnect) {
		while (true) {
			try {
				// вызываем окна ввода адреса, порта сервера
				String addressServer = gui.getServerAddressFromOptionPane();
				int port = gui.getPortServerFromOptionPane();
				// создаем сокет и объект connection
				Socket socket = new Socket(addressServer, port);
				connection = new Connection(socket);
				isConnect = true;
				gui.addMessage("Сервисное сообщение: Вы подключились к серверу.\n");
				break;
			} catch (Exception e) {
				gui.errorDialogWindow(
						"Произошла ошибка! Возможно Вы ввели неверный адрес сервера или порт. Попробуйте еще раз");
				break;
			}
		}
	} else
		gui.errorDialogWindow("Вы уже подключены!");
}
```

Тут `Client` проверяет флаг `isConnect`, и если подключения к серверу не было, — пытается его установить (блок `try`). Если подключение установить не удается — исполнение программы переходит к блоку `catch`, выводу аварийного сообщения и выходу из метода.


## Автоматическое тестирование

### JUnit

JUnit — это один из самых известных и широко используемых фреймворков для автоматического тестирования кода на языке Java. Он предоставляет набор аннотаций и утверждений (assertions) для написания тестов, а также интегрируется с большинством сред разработки (IDE) и систем сборки.

### TestNG

TestNG — это еще один популярный фреймворк для автоматического тестирования Java кода. Он предоставляет более широкий функционал по сравнению с JUnit, включая поддержку параллельного выполнения тестов, гибкую конфигурацию тестов и возможность использования аннотаций для определения зависимостей между тестами.

### Mockito

Mockito — это библиотека для создания мок-объектов (mock objects) при тестировании Java кода. Она позволяет имитировать поведение объектов, с которыми взаимодействует ваш код, что упрощает написание тестов для сложных систем.

## Пример теста проекта
При создании проекта используется [Maven](https://ru.wikipedia.org/wiki/Apache_Maven/ "Вики по Maven"). В папке test, по пути, аналогичному основным файлам проекта создается файл теста. В конкретном случае это: \test\java\com\example\Client\сlientTest.java.

```java
package com.example.Client;

import static org.junit.jupiter.api.Assertions.assertFalse;
import static org.junit.jupiter.api.Assertions.assertTrue;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

class сlientTest {
	static Client client;

	@BeforeAll
	public static void setUp() {
		client = new Client();
	}

	@Test
	@DisplayName("Проверка статуса подключения: по умолчанию — false")
	public void testIsConnectInitialValue() {
		assertFalse(client.isConnect()); // by default isConnect should be false
	}

	@Test
	@DisplayName("Проверка статуса подключения: после установки метода isConnect в true, тест должен возвращать true")
	public void testSetConnect() {
		client.setConnect(true);
		assertTrue(client.isConnect()); // after setting isConnect to true, it should return true
	}

	@Test
	@DisplayName("Заглушка для этого и последующих тестов")
	public void testReceiveMessageFromServer() {
		// Подготовка данных для теста

		// Выполнение действия

		// Проверка результата
	}

	// Другие тесты для других методов класса Client
}
```

Здесь в блоке импорта подтягиваются инструменты фреймворка JUnit, а в коде с помощью директив вызываются проверки предположений. 

Так например 

```java
assertFalse(client.isConnect());
```
указывает, что метод `isConnect()` объекта `client` должен вернуть `false`. И если тест будет пройден — значит предположение было верным.

Подобным образом тестируются прочие методы класса, в зависимости от требуемого объема покрытия проекта тестами. 

---
Результат выполнения тестов:
![Результат выполнения тестов: скриншот](/img/page01.png "Tests result")


## Сценарии тестирования мессенджера 
Как и любой конкретный тип приложения, приложение для обмена сообщениями имеет свою специфику, требования и проблемы при тестировании.

### Installation Testing
Правильные сообщения об ошибках отображаются когда кто-то пытается зарегистрироваться или войти с некорректными данными;

Регистрация или вход с неверными данными невозможны;

### Usability Testing
Приложение интуитивно понятным и простым в использовании;

Интерфейс приложения должен соответствовать стандартам цвета, значков и расположению значков для хорошо зарекомендовавших себя функций в мессенджере, чтобы избежать путаницы;

Цвета букв и фона, размер букв и шрифт должны позволять пользователям легко читать сообщения;

Приложение должно быть доступным для людей с разным зрением, моторикой и возможностями.

### Functional Testing
Пользователь может отправлять и получать сообщения;

Время доставки сообщения и любая другая ожидаемая информация о сообщении правильно отображаются для пользователя;

Приложение правильно определяет статус сообщения, когда сообщение доставлено, прочитано и/или не доставлено;

Пользователь может копировать и вставлять сообщения и их части;

История чата правильно отображается;

Возможность создания групповых чатов в мессенджере и их корректная работа;

Когда пользователь присоединяется к групповому чату или покидает его, соответствующее уведомление об этом должно отображаться для всех участников группового чата;

Пользователь может блокировать контакты в мессенджере и заблокированные контакты больше не могут взаимодействовать с пользователем;

### Performance Testing
Мессенджер работает корректно при разных типах сетевого подключения (2G, 3G, 4G, 5G, WiFi), при переключении между ними, а также при общении между собой пользователей мессенджера с разными типами сетевого подключения;

Скорость доставки сообщений должна быть мгновенной;

Нагрузочное тестирование, чтобы оценить, сколько пользователей могут одновременно использовать приложение для обмена сообщениями;

### Compatibility Testing
Приложение правильно работает на разных типах, моделях и версиях устройств;

Мессенджер работает корректно с разными операционными системами;

### Security Testing
Содержимое сообщения защищено от перехвата, когда оно хранится на устройстве пользователя, отправляется на устройство получателя и сохраняется на устройстве получателя;

Автоматическое уничтожение сообщений через временной интервал.
